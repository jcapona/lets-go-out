<!-- index.ejs -->
<div id="header" class="text-center">
    	<h1>Plans tonight? <small>Find out what's going on in your area</small></h1>
</div>

<div id="search-bar">
  <div class="row">
    <div class="col-md-12">
      <div class="input-group">

        <span class="input-group-addon input-lg" style="background-color: white; border-width: 0px;">
          <i class="fa fa-map-marker fa-1x"></i>
        </span>
        
        <input id="search" type="text" name="location" class="form-control input-lg" placeholder="Where are you?">
        
        <span class="input-group-btn">
          <button id="search-btn" class="btn btn-default input-lg" type="button">Go!</button>
        </span>

      </div>
    </div>
  </div>
</div>

<div>
  <span  id="search-results"></span>
</div>


<script type="text/javascript">

  $("#search").keypress(function() {
    console.log("Handler for .change() called.");
    $("#header").addClass("hidden");
  });

  $("#search-btn").on('click',function(e)
  {
    $("#search-results").html('<div class="text-center"><i class="fa fa-spinner fa-spin fa-5x"></i></div>');

    e.stopPropagation();
    e.preventDefault();
    
    $.ajax({
      url: '/event/',
      type: 'GET',
      data: $("#search").serialize(),
      error: function(jqXHR, textStatus, errorThrown) {
        console.log('Error: ' + textStatus);
      },
      success: function(data) {
        console.log(data);
        parseJsonResults(data.message.businesses);
      }
    });
  });

  function parseJsonResults(data) {
/*
    var html = "";
    html += "<table>";


    for(var i=0; i < data.length; i++)
      {
      html += "<tr>";
        html += "<td>";
          html += "<img src="+data[i.toString()]['image_url']+" class='img-responsive'>";
        html += "</td>";
        html += "<td>";
          html += "<p>"+data[i.toString()]['name']+"</p>";
          html += "<img src="+data[i.toString()]['rating_img_url']+" class='img-responsive'>";
          html += "<p>"+data[i.toString()]['review_count']+"</p>";
          html += "<p>"+data[i.toString()]['location']['display_address']+"</p>";
        html += "</td>";
      html += "</tr>";
    };

    html += "</table>";
*/
    var html = "";
    for(var i=0; i < data.length; i++)
    {
      html += "<div class='media'>";
        html += "<div class='media-left'>";
          html += "<a href="+data[i.toString()]['url']+">";
              html += "<img src="+data[i.toString()]['image_url']+" class='media-object pull-left'>";
          html += "</a>";
        html += "</div>";
        html += "<div class='media-body' >";
          html += "<h4 class='media-heading'>"+data[i.toString()]['name']+"</h4>";
          html += "<p>"
            html += "<img src="+data[i.toString()]['rating_img_url']+" class='img-responsive' style='display: inline;'> ";
            html += data[i.toString()]['review_count']+" reviews";
          html += "</p>";
        html += "</div>";
      html += "</div>";
    }
    
    $("#search-results").html('');
    $("#search-results").append(html);
  }

</script>